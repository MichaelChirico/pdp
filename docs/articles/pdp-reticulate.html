<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Explaining scikit-learn models with pdp via reticulate • pdp</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Explaining scikit-learn models with pdp via reticulate">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pdp</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.7.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/pdp.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/pdp-classification.html">Interpretting classification models</a>
    </li>
    <li>
      <a href="../articles/pdp-computation.html">Reducing computation time</a>
    </li>
    <li>
      <a href="../articles/pdp-example-tensorflow.html">A TensorFlow example using the Keras API</a>
    </li>
    <li>
      <a href="../articles/pdp-example-xgboost.html">Interpreting XGBoost models</a>
    </li>
    <li>
      <a href="../articles/pdp-extending.html">User-defined prediction functions</a>
    </li>
    <li>
      <a href="../articles/pdp-reticulate.html">Explaining scikit-learn models with pdp via reticulate</a>
    </li>
    <li>
      <a href="../articles/pdp-se.Rmd.html">Single-variable PDPs with standard deviations</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/bgreenwell/pdp">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Explaining scikit-learn models with pdp via reticulate</h1>
                        <h4 class="author">Brandon M. Greenwell</h4>
            
            <h4 class="date">12 January, 2019</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/bgreenwell/pdp/blob/master/vignettes/pdp-reticulate.Rmd"><code>vignettes/pdp-reticulate.Rmd</code></a></small>
      <div class="hidden name"><code>pdp-reticulate.Rmd</code></div>

    </div>

    
    
<p>In this vignette, we’ll cover how to use <a href="https://rstudio.github.io/reticulate/">reticulate</a> to interface <a href="https://bgreenwell.github.io/pdp/index.html">pdp</a> with <a href="https://scikit-learn.org/stable/index.html">scikit-learn</a> models. First, we’ll install (if necessary) and load any required packages:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># Install required packages</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2">pkgs &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"ggplot2"</span>, <span class="st">"pdp"</span>, <span class="st">"reticulate"</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="cf">for</span> (pkg <span class="cf">in</span> pkgs) {</a>
<a class="sourceLine" id="cb1-4" data-line-number="4">  <span class="cf">if</span> (<span class="op">!</span>(pkg <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/installed.packages">installed.packages</a></span>()[, <span class="st">"Package"</span>])) {</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">    <span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages</a></span>(pkg)</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">  }</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb1-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="co"># Load required packages</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2)     <span class="co"># for awesome graphics</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(pdp)         <span class="co"># for feature effects</span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(reticulate)  <span class="co"># for R interface to Python</span></a></code></pre></div>
<p>Depending on your setup, you may need to point to the location of a specific version of Python (you can use <code><a href="https://www.rdocumentation.org/packages/reticulate/topics/py_config">reticulate::py_config()</a></code> to see what the default is on your system). Below, we point to a specific Anaconda distribution of Python installed in a local directory:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/reticulate/topics/use_python">use_python</a></span>(<span class="st">"/Users/b780620/anaconda3/bin/python3"</span>)</a></code></pre></div>
<p>Next, we’ll set up the training data for modeling (in this case, we’ll use the well-known Boston housing data):</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">X &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.matrix">data.matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/subset">subset</a></span>(pdp<span class="op">::</span>boston, <span class="dt">select =</span> <span class="op">-</span>cmedv))</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">y &lt;-<span class="st"> </span>pdp<span class="op">::</span>boston<span class="op">$</span>cmedv</a></code></pre></div>
<p>Finally, we’ll fit a <span class="math inline">\(k\)</span>-nearest neighbor regressor (with <span class="math inline">\(k = 10\)</span>) to the training data using <strong>scikit-learn</strong>’s <code>neighbors</code> module:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">neighbors &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/reticulate/topics/import">import</a></span>(<span class="st">"sklearn.neighbors"</span>)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">knr &lt;-<span class="st"> </span>neighbors<span class="op">$</span><span class="kw">KNeighborsRegressor</span>(<span class="dt">n_neighbors =</span> 10L)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">knr_fit &lt;-<span class="st"> </span>knr<span class="op">$</span><span class="kw">fit</span>(X, y)</a></code></pre></div>
<p>To use <strong>pdp</strong> with <strong>scikit-learn</strong> models via <strong>reticulate</strong>, you just need to tell <code><a href="../reference/partial.html">partial()</a></code> how to compute predictions for new data. For this, we can write a simple wrapper function (<strong>Note:</strong> see <a href="https://bgreenwell.github.io/pdp/articles/pdp-extending.html">this vignette</a> for details on using <strong>pdp</strong> with user-defined prediction functions). In particular, we’ll write two functions: one to compute predictions for <em>individual conditional expectation</em> (ICE) curves <span class="citation">(Goldstein et al. 2015)</span>, and one to compute averaged predictions for <em>partial dependence plots</em> (PDPs) <span class="citation">(Friedman 2001)</span>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co"># For ICE curves, this function should return one prediction for each row</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">pfun_ice &lt;-<span class="st"> </span><span class="cf">function</span>(object, newdata) {</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">  object<span class="op">$</span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict</a></span>(newdata)</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb5-5" data-line-number="5"></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="co"># For PDPs, this function should return one averaged prediction</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7">pfun_pdp &lt;-<span class="st"> </span><span class="cf">function</span>(object, newdata) {</a>
<a class="sourceLine" id="cb5-8" data-line-number="8">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(object<span class="op">$</span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict</a></span>(newdata))</a>
<a class="sourceLine" id="cb5-9" data-line-number="9">}</a></code></pre></div>
<p>Next, we’ll call <code><a href="../reference/partial.html">partial()</a></code> as usual and pass the prediction wrappers to the <code>pred.fun</code> argument. In the first code chunk, we pass in the <code>pfun_ice</code> function and request centered ICE curves (i.e., <code>center = TRUE</code>):</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="../reference/partial.html">partial</a></span>(knr_fit, <span class="dt">pred.var =</span> <span class="st">"age"</span>, <span class="dt">train =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.data.frame">as.data.frame</a></span>(X), </a>
<a class="sourceLine" id="cb6-2" data-line-number="2">        <span class="dt">pred.fun =</span> pfun_ice, <span class="dt">plot =</span> <span class="ot">TRUE</span>, <span class="dt">plot.engine =</span> <span class="st">"ggplot2"</span>, </a>
<a class="sourceLine" id="cb6-3" data-line-number="3">        <span class="dt">center =</span> <span class="ot">TRUE</span>, <span class="dt">alpha =</span> <span class="fl">0.1</span>)</a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="co">#&gt; Warning: Ignoring unknown parameters: smooth, contour, contour.colour,</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="co">#&gt; palette</span></a></code></pre></div>
<p><img src="pdp-reticulate_files/figure-html/ice-1.png" width="70%" style="display: block; margin: auto auto auto 0;"></p>
<p>While ICE curves only work for a single feature, PDPs can be plotted for any subset of the feature space (although, plotting more than 2–3 features is not very useful). In the code chunks below, we construct PDPs for <code>lstat</code> and (<code>lstat</code>, <code>rm</code>):</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="../reference/partial.html">partial</a></span>(knr_fit, <span class="dt">pred.var =</span> <span class="st">"lstat"</span>, <span class="dt">train =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.data.frame">as.data.frame</a></span>(X), </a>
<a class="sourceLine" id="cb7-2" data-line-number="2">        <span class="dt">pred.fun =</span> pfun_pdp, <span class="dt">plot =</span> <span class="ot">TRUE</span>, <span class="dt">plot.engine =</span> <span class="st">"ggplot2"</span>)</a></code></pre></div>
<p><img src="pdp-reticulate_files/figure-html/pdp-1.png" width="70%" style="display: block; margin: auto auto auto 0;"></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw"><a href="../reference/partial.html">partial</a></span>(knr_fit, <span class="dt">pred.var =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"lstat"</span>, <span class="st">"rm"</span>), <span class="dt">train =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.data.frame">as.data.frame</a></span>(X), </a>
<a class="sourceLine" id="cb8-2" data-line-number="2">        <span class="dt">pred.fun =</span> pfun_pdp, <span class="dt">plot =</span> <span class="ot">TRUE</span>, <span class="dt">plot.engine =</span> <span class="st">"ggplot2"</span>, </a>
<a class="sourceLine" id="cb8-3" data-line-number="3">        <span class="dt">palette =</span> <span class="st">"magma"</span>, <span class="dt">chull =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="pdp-reticulate_files/figure-html/pdp-bivariate-1.png" width="70%" style="display: block; margin: auto auto auto 0;"></p>
<div id="refs" class="references">
<div id="ref-friedman-greedy-2001">
<p>Friedman, Jerome H. 2001. “Greedy Function Approximation: A Gradient Boosting Machine.” <em>The Annals of Statistics</em> 29: 1189–1232. <a href="https://doi.org/10.1214/aos/1013203451">https://doi.org/10.1214/aos/1013203451</a>.</p>
</div>
<div id="ref-goldstein-peeking-2015">
<p>Goldstein, Alex, Adam Kapelner, Justin Bleich, and Emil Pitkin. 2015. “Peeking Inside the Black Box: Visualizing Statistical Learning with Plots of Individual Conditional Expectation.” <em>Journal of Computational and Graphical Statistics</em> 24 (1): 44–65. <a href="https://doi.org/10.1080/10618600.2014.907095">https://doi.org/10.1080/10618600.2014.907095</a>.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Brandon Greenwell.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
