<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Single-variable PDPs with standard deviations • pdp</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Single-variable PDPs with standard deviations">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pdp</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.6.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/pdp.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/pdp-classification.html">Interpretting classification models</a>
    </li>
    <li>
      <a href="../articles/pdp-computation.html">Reducing computation time</a>
    </li>
    <li>
      <a href="../articles/pdp-example-tensorflow.html">A TensorFlow example using the Keras API</a>
    </li>
    <li>
      <a href="../articles/pdp-example-xgboost.html">Interpreting XGBoost models</a>
    </li>
    <li>
      <a href="../articles/pdp-extending.html">User-defined prediction functions</a>
    </li>
    <li>
      <a href="../articles/pdp-se.Rmd.html">Single-variable PDPs with standard deviations</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/bgreenwell/pdp">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Single-variable PDPs with standard deviations</h1>
                        <h4 class="author">Brandon M. Greenwell</h4>
            
            <h4 class="date">2018-08-24</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/bgreenwell/pdp/blob/master/vignettes/pdp-se.Rmd.Rmd"><code>vignettes/pdp-se.Rmd.Rmd</code></a></small>
      <div class="hidden name"><code>pdp-se.Rmd.Rmd</code></div>

    </div>

    
    
<p>It is possible to construct PDPs with pointwise variability estimates (e.g., +/- one standard deviation). This can be done easily with the <code>pred.fun</code> argument of <code><a href="../reference/partial.html">partial()</a></code>. To illustrate, we’ll fit a random forest to the famous iris data and construct a PDP for the most important variable that displays pointwise standard deviation bands.</p>
<p>In the code chunk below, we use the <strong>ranger</strong> package <span class="citation">(Wright, Wager, and Probst 2018)</span> to fit a random forest to the built-in iris data. Note that in order to use the <strong>vip</strong> <span class="citation">(Greenwell and Boehmke, n.d.)</span> and <strong>pdp</strong> <span class="citation">(Greenwell 2017)</span> packages for classification models, we need to be able to compute the predicted class probabilities. Therefore, we must specify <code>probability = TRUE</code> in the call to <code><a href="http://www.rdocumentation.org/packages/ranger/topics/ranger">ranger()</a></code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(ranger)  <span class="co"># for fitting random forests</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">set.seed</span>(<span class="dv">101</span>)  <span class="co"># for reproducibility</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3">rfo &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ranger/topics/ranger">ranger</a></span>(Species <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> iris, <span class="dt">probability =</span> <span class="ot">TRUE</span>, </a>
<a class="sourceLine" id="cb1-4" data-line-number="4">              <span class="dt">importance =</span> <span class="st">"impurity"</span>)</a></code></pre></div>
<p>Next, we’ll use the <strong>vip</strong> package to construct a variable importance plot (VIP) from the fitted random forest. The default for <code><a href="http://www.rdocumentation.org/packages/vip/topics/vip">vip()</a></code> is to construct model-specific VIPs if availble. Since we specified <code>importance = "impurity"</code> in the call to <code><a href="http://www.rdocumentation.org/packages/ranger/topics/ranger">ranger()</a></code>, <code><a href="http://www.rdocumentation.org/packages/vip/topics/vip">vip()</a></code> will plot the impurity-based variable importance scores common with most decision tree-based algorithms.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">library</span>(vip)  <span class="co"># for variable importance plots</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co">#&gt; Attaching package: 'vip'</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co">#&gt; The following object is masked from 'package:utils':</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co">#&gt;     vi</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="kw"><a href="http://www.rdocumentation.org/packages/vip/topics/vip">vip</a></span>(rfo)</a></code></pre></div>
<div class="figure" style="text-align: left">
<img src="pdp-se.Rmd_files/figure-html/iris-02-1.png" alt="**Figure 1** Variable importance plot from a random forest fit to the iris data set." width="70%"><p class="caption">
<strong>Figure 1</strong> Variable importance plot from a random forest fit to the iris data set.
</p>
</div>
<p>It appears from <strong>Figure 1</strong> that <code>Petal.Width</code> and <code>Petal.Length</code> are the most important features in predicting <code>Species</code>. Now that we’ve identified these important features, we’ll construct PDPs for each that include pointwise standard deviation bands. To do this, we’ll specify a special prediction function that returns three components: the average prediction, the average prediction minus one standard deviation, and the average prediction plus one standard deviation. This function is defined below; note that this function requires the arguments <code>object</code> and <code>newdata</code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">pred_wrapper &lt;-<span class="st"> </span><span class="cf">function</span>(object, newdata) {</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">  p &lt;-<span class="st"> </span><span class="kw">predict</span>(object, <span class="dt">data =</span> newdata)<span class="op">$</span>predictions[, 1L, drop =<span class="st"> </span><span class="ot">TRUE</span>]</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">  <span class="kw">c</span>(<span class="st">"avg"</span> =<span class="st"> </span><span class="kw">mean</span>(p), <span class="st">"avg-1sd"</span> =<span class="st"> </span><span class="kw">mean</span>(p) <span class="op">-</span><span class="st"> </span><span class="kw">sd</span>(p), <span class="st">"avg+1sd"</span> =<span class="st"> </span><span class="kw">mean</span>(p) <span class="op">+</span><span class="st"> </span><span class="kw">sd</span>(p))</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">}</a></code></pre></div>
<p>Next, we just supply this function via the <code>pred.fun</code> argument in the call to <code><a href="../reference/partial.html">partial()</a></code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">library</span>(pdp)  <span class="co"># for partial dependence plots</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">pd1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/partial.html">partial</a></span>(rfo, <span class="dt">pred.var =</span> <span class="st">"Petal.Width"</span>, <span class="dt">pred.fun =</span> pred_wrapper)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">pd2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/partial.html">partial</a></span>(rfo, <span class="dt">pred.var =</span> <span class="st">"Petal.Length"</span>, <span class="dt">pred.fun =</span> pred_wrapper)</a></code></pre></div>
<p>To plot the resulting PDPs, we could’ve just specified <code>plot = TRUE</code> in the previous calls to <code><a href="../reference/partial.html">partial()</a></code>. However, since PDPs can be computationally expensive to compute (though, not in this example), it is good practice to store the results first, and then manually construct the plot. We’ll use the convenient <code><a href="http://www.rdocumentation.org/packages/ggplot2/topics/autoplot">autoplot()</a></code> function provided by <strong>pdp</strong> to construct the plots (which requires that the <strong>ggplot2</strong> package <span class="citation">(Wickham et al. 2018)</span> be laoded first). The results are displayed in <strong>Figure 2</strong>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">library</span>(ggplot2)  <span class="co"># for autoplot() generic</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">pdp1 &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/autoplot">autoplot</a></span>(pd1) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_light</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">labs</a></span>(<span class="dt">x =</span> <span class="st">"Petal width (mm)"</span>, <span class="dt">y =</span> <span class="st">"Partial dependence"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/theme">theme</a></span>(<span class="dt">legend.position =</span> <span class="st">"none"</span>)</a>
<a class="sourceLine" id="cb5-6" data-line-number="6">pdp2 &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/autoplot">autoplot</a></span>(pd2) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_light</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">labs</a></span>(<span class="dt">x =</span> <span class="st">"Petal length (mm)"</span>, <span class="dt">y =</span> <span class="st">"Partial dependence"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/theme">theme</a></span>(<span class="dt">legend.position =</span> <span class="st">"none"</span>)</a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="kw"><a href="../reference/grid.arrange.html">grid.arrange</a></span>(pdp1, pdp2, <span class="dt">nrow =</span> <span class="dv">1</span>)  <span class="co"># display plots side by side</span></a></code></pre></div>
<div class="figure" style="text-align: left">
<img src="pdp-se.Rmd_files/figure-html/iris-05-1.png" alt="**Figure 2** Partial dependence of `Species` on `Petal.Width` (left) and `Petal.Length` (right). The red lines is the PDP while the black lines indicate pointwise +/- one standard deviation." width="100%"><p class="caption">
<strong>Figure 2</strong> Partial dependence of <code>Species</code> on <code>Petal.Width</code> (left) and <code>Petal.Length</code> (right). The red lines is the PDP while the black lines indicate pointwise +/- one standard deviation.
</p>
</div>
<div id="refs" class="references">
<div id="ref-R-vip">
<p>Greenwell, Brandon, and Brad Boehmke. n.d. <em>Vip: Variable Importance Plots</em>. <a href="https://koalaverse.github.io/vip/index.html" class="uri">https://koalaverse.github.io/vip/index.html</a>.</p>
</div>
<div id="ref-R-pdp">
<p>Greenwell, Brandon M. 2017. “Pdp: An R Package for Constructing Partial Dependence Plots.” <em>The R Journal</em> 9 (1): 421–36. <a href="https://journal.r-project.org/archive/2017/RJ-2017-016/index.html" class="uri">https://journal.r-project.org/archive/2017/RJ-2017-016/index.html</a>.</p>
</div>
<div id="ref-R-ggplot2">
<p>Wickham, Hadley, Winston Chang, Lionel Henry, Thomas Lin Pedersen, Kohske Takahashi, Claus Wilke, and Kara Woo. 2018. <em>Ggplot2: Create Elegant Data Visualisations Using the Grammar of Graphics</em>. <a href="https://CRAN.R-project.org/package=ggplot2" class="uri">https://CRAN.R-project.org/package=ggplot2</a>.</p>
</div>
<div id="ref-R-ranger">
<p>Wright, Marvin N., Stefan Wager, and Philipp Probst. 2018. <em>Ranger: A Fast Implementation of Random Forests</em>. <a href="https://CRAN.R-project.org/package=ranger" class="uri">https://CRAN.R-project.org/package=ranger</a>.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Brandon Greenwell.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
